;;;;;;;;;;;;;;;;;;;;;;;
; Test: Controlled test with fewer iterations
;;;;;;;;;;;;;;;;;;;;;;;

(include "00_base.egglog")

; Numeric multiplication
(rewrite
 (Mk (@* (Args (Mk (Num x)) (Args (Mk (Num y)) (Empty)))))
 (Mk (Num (* x y))))

; 0 + a = a
(rewrite
 (Mk (@+ (Args (Mk (Num 0)) (Args (Mk a) (Empty)))))
 (Mk a))

; a + 0 = a
(rewrite
 (Mk (@+ (Args (Mk a) (Args (Mk (Num 0)) (Empty)))))
 (Mk a))

; RIGHT Distributivity only
(rewrite
 (Mk (@*
     (Args
         (Mk p1)
         (Args (Mk (@+ (Args (Mk p2) (Args (Mk p3) (Empty))))) (Empty)))))
 (Mk (@+
     (Args
         (Mk (@* (Args (Mk p1) (Args (Mk p2) (Empty)))))
             (Args (Mk (@* (Args (Mk p1) (Args (Mk p3) (Empty))))) (Empty))))))

; 0 * a = 0
(rewrite
 (Mk (@* (Args (Mk (Num 0)) (Args (Mk a) (Empty)))))
 (Mk (Num 0)))

; a * 0 = 0
(rewrite
 (Mk (@* (Args (Mk a) (Args (Mk (Num 0)) (Empty)))))
 (Mk (Num 0)))

; Variable normalization
(rewrite
 (Mk (Var x))
 (Mk (@+ (Args (Mk (@* (Args (Mk (Num 1)) (Args (Mk (Var x)) (Empty)))))
               (Args (Mk (Num 0)) (Empty))))))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; WHAT DOES x * (2*y) normalize to?
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(let goal_lhs (Mk (@* (Args (Mk (Var 1)) (Args (Mk (@* (Args (Mk (Num 2)) (Args (Mk (Var 2)) (Empty))))) (Empty))))))
(let goal_rhs (Mk (@* (Args (Mk (Num 2)) (Args (Mk (@* (Args (Mk (Var 1)) (Args (Mk (Var 2)) (Empty))))) (Empty))))))

(Avaliable goal_lhs)
(Avaliable goal_rhs)

(run-schedule (repeat 5 (run)))

; Extract to see what they normalized to
(query-extract goal_lhs)
(query-extract goal_rhs)

(print-stats)
